# Система подсчета количества студентов в аудитории

Проект представляет собой систему для подсчета количества студентов в аудитории с использованием компьютерного зрения (YOLO) и веб-интерфейса.

# Организация проекта

## Структура проекта

- `app/` - основной код приложения
  - `api/` - API маршруты FastAPI
  - `core/` - основные модули (настройки, база данных)
  - `ml/` - модули машинного обучения
  - `models/` - модели данных
  - `schemas/` - Pydantic схемы для API
- `alembic/` - миграции базы данных
- `frontend/` - клиентская часть
- `utils/` - вспомогательные скрипты
  - `create_mysql_db.py` - создание базы данных MySQL
  - `create_tables.py` - создание таблиц в базе данных
  - `check_mysql.py` - проверка соединения с MySQL
  - `check_tables.py` - проверка структуры таблиц
  - `add_test_data.py` - добавление тестовых данных
  - `clear_test_data.py` - очистка тестовых данных
  - `test_camera.py` - тестирование камеры

## Требования

- Python 3.8+
- Node.js 14+
- MySQL 5.7+ или MariaDB 10.5+

## Запуск приложения

### Настройка базы данных MySQL

```bash
python setup_mysql.py
```

### Запуск сервера

Вариант 1 (через uvicorn напрямую):
```bash
uvicorn app.main:app --reload
```

Вариант 2 (через скрипт run.py):
```bash
python run.py
```

Сервер будет доступен по адресу: http://localhost:8000

### Фронтенд

1. Перейдите в директорию frontend:
```
cd frontend
```

2. Установите зависимости:
```
npm install
```

3. Запустите фронтенд:
```
npm start
```

Фронтенд будет доступен по адресу: http://localhost:3000

## API эндпоинты

- `GET /api/v1/detect-live` - Запуск детекции с камеры
- `POST /api/v1/detect-image` - Детекция на загруженном изображении
- `GET /api/v1/attendance` - Получение истории посещаемости
- `POST /api/v1/attendance` - Добавление записи о посещаемости

## Работа с базой данных

Для управления базой данных MySQL рекомендуется использовать:
- phpMyAdmin (доступен через XAMPP)
- MySQL Workbench: https://dev.mysql.com/downloads/workbench/
- DBeaver: https://dbeaver.io/download/ (универсальный клиент для разных СУБД)

## Миграции базы данных

Для создания новой миграции:

```
alembic revision --autogenerate -m "описание изменений"
```

Для применения миграций:

```
alembic upgrade head
```

Для отката миграций:

```
alembic downgrade -1
```

# Настройка MySQL для проекта

## Проблемы с запуском MySQL в XAMPP

Если у вас возникают проблемы с запуском MySQL в XAMPP, попробуйте следующие шаги:

### 1. Проверка конфликта портов

MySQL по умолчанию использует порт 3306. Возможно, другая программа уже использует этот порт.

```
netstat -ano | findstr 3306
```

Если вы видите, что порт занят, найдите процесс по его PID в Диспетчере задач и завершите его.

### 2. Проверка и исправление файлов MySQL

1. Остановите все службы в XAMPP
2. Перейдите в папку `C:\xampp\mysql\data`
3. Сделайте резервную копию этой папки
4. Удалите файлы `ib_logfile0` и `ib_logfile1` (они будут созданы заново)
5. Попробуйте запустить MySQL снова

### 3. Исправление my.ini

1. Откройте файл `C:\xampp\mysql\bin\my.ini`
2. Найдите и измените следующие параметры:
   ```
   port=3306
   socket="C:/xampp/mysql/mysql.sock"
   ```
3. Убедитесь, что пути указаны правильно для вашей установки XAMPP

### 4. Запуск от имени администратора

Запустите XAMPP Control Panel от имени администратора (правый клик -> Запуск от имени администратора).

### 5. Альтернативное решение - использование SQLite

Если проблемы с MySQL не решаются, вы можете использовать SQLite:
1. Откройте файл `app/core/config.py`
2. Установите `DB_TYPE = "sqlite"`
3. Запустите приложение - оно будет использовать локальную базу данных SQLite

## Настройка проекта для MySQL

Когда MySQL работает корректно:

1. Измените настройки в `app/core/config.py`:
   ```python
   DB_TYPE = "mysql"
   ```

2. Установите нужные пакеты:
   ```
   pip install mysql-connector-python pymysql
   ```

3. Создайте базу данных:
   ```
   python create_mysql_db.py
   ```

4. Запустите приложение:
   ```
   uvicorn app.main:app --reload
   ```
